<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<title>Log in</title>
		<!-- Tell the browser to be responsive to screen width -->
		<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
		<!-- Bootstrap 3.3.7 -->
		<link rel="stylesheet" href="/static/bower_components/bootstrap/dist/css/bootstrap.min.css">
		<!-- Font Awesome -->
		<link rel="stylesheet" href="/static/bower_components/font-awesome/css/font-awesome.min.css">
		<!-- Ionicons -->
		<link rel="stylesheet" href="/static/bower_components/Ionicons/css/ionicons.min.css">
		<!-- Theme style -->
		<link rel="stylesheet" href="/static/dist/css/AdminLTE.min.css">
		<!-- iCheck -->
		<link rel="stylesheet" href="/static/plugins/iCheck/square/blue.css">
		<!-- spinnerWait -->
		<link rel="stylesheet" href="/static/css/spinnerWait.css">
		<!-- bootstrapValidator -->
		<link rel="stylesheet" type="text/css" href="/static/bootstrapvalidator/vendor/bootstrap/css/bootstrap-theme.css" />
		<link rel="stylesheet" type="text/css" href="/static/bootstrapvalidator/dist/css/bootstrapValidator.css" />
		<script type="text/javascript" src="/static/bootstrapvalidator/vendor/jquery/jquery-1.10.2.min.js"></script>
		<script type="text/javascript" src="/static/bootstrapvalidator/vendor/bootstrap/js/bootstrap.min.js"></script>
		<script type="text/javascript" src="/static/bootstrapvalidator/dist/js/bootstrapValidator.js"></script>
		<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
		<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
		<!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->

		<!-- Google Font -->
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,300italic,400italic,600italic">
		<style type="text/css">
			.login-page {
				background: url(static/img/1140858.jpg) no-repeat;
				background-size: cover;
			}
			
			.login-logo a {
				color: lightslategray;
			}
			
			.login-box {
				margin: 0px auto;
				padding-top: 100px;
			}
			
			.login-box-body {
				border-radius: 10px;
				/*background-color: rgba(175,153,129,0.8);*/
			}
			
			.login-box-body a {
				font-size: 12px;
			}
			
			.login-box-body a:hover {
				text-decoration: underline;
			}
			
			.error-tips {
				font-size: 12px;
				color: red;
				height: 320px;
				height: 20px;
				display: none;
			}
		</style>
	</head>

	<body class="hold-transition login-page">
		<div class="login-box">
			<div class="login-logo">
				<a href="javascript:;"><b>Admin</b>EAP</a>
			</div>
			<!-- /.login-logo -->
			<div class="login-box-body">
				<p class="login-box-msg">开始登录/测试用例pangmaomi@163.com/111111</p>
				<div class="error-tips"></div>
				<form action="" method="post" id="loginForm">
					<div class="form-group has-feedback">
						<input type="text" class="form-control" placeholder="邮箱" name="email" id="email">
						<span class="glyphicon glyphicon-envelope form-control-feedback"></span>
					</div>
					<div class="form-group has-feedback">
						<input type="password" class="form-control" placeholder="密码" name="password" id="password">
						<span class="glyphicon glyphicon-lock form-control-feedback"></span>
					</div>
					<div class="row">
						<div class="col-xs-8">
							<div class="checkbox icheck">
								<label>
              						<input type="checkbox" id="remember">记住我
            					</label>
							</div>
						</div>
						<!-- /.col -->
						<div class="col-xs-4">
							<button type="submit" id="validateBtn" class="btn btn-info btn-primary btn-block btn-flat">登录</button>
						</div>
						<!-- /.col -->
					</div>
				</form>

				<a href="#">忘记密码</a><br>
				<a href="register.html" class="text-center">未拥有帐号？去注册</a>

			</div>
			<!-- /.login-box-body -->

		</div>
		<!-- /.login-box -->
		<!--#tipsModal-->
		<div id="tipsModal" class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel">
			<div class="modal-dialog modal-sm" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title">提示信息:</h4>
					</div>
					<div class="modal-body">
						<p id="response-erro"></p>
						<div class="spinner">
							<div class="bounce1"></div>
							<div class="bounce2"></div>
							<div class="bounce3"></div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!--/#tipsModal-->
		<!--#tipsModal2-->
		<div id="tipsModal2" class="modal fade" tabindex="-1" role="dialog">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title">提示信息:</h4>
					</div>
					<div class="modal-body">
						<p id="response-erro">正在登录，请等候</p>
						<div class="spinner">
							<div class="bounce1"></div>
							<div class="bounce2"></div>
							<div class="bounce3"></div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!--/#tipsModal2-->

		<!-- jQuery 3 -->
		<!-- <script src="bower_components/jquery/dist/jquery.min.js"></script> -->
		<!-- Bootstrap 3.3.7 -->
		<!-- <script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script> -->
		<!-- iCheck -->
		<script src="/static/plugins/iCheck/icheck.min.js"></script>
		<!-- zh_CN -->
		<script src="/static/bootstrapvalidator/dist/js/language/zh_CN.js"></script>
		<script>
			$(function() {

				//				设置自动登录

				/*$.ajax({
					method: "post",
					url: "php/autologin.php",
					data: {
						remember: sessionStorage.getItem('remember')
					},
					success: function(data) {
						var rep = $.parseJSON(data);
						if(rep.code == 1) {
							$("#email").val(rep.msg);
							var pwd = sessionStorage.getItem(rep.msg);
//							console.log(pwd);
							$("#password").val(pwd);
							$('#tipsModal2').modal();
							$(".spinner").css("display", "block");
							setTimeout(function() {
								location.href = "home.html";
							}, 3000);
						}else{
							$("#tipsModal2").css("display","none");
							
						}

					}

				});*/

				/*var json = [{"email":"123@163.com","username":"\u80d6\u732b\u54aa","password":"123123"}]
				console.log(json[0].email)*/
				$('input').iCheck({
					checkboxClass: 'icheckbox_square-blue',
					radioClass: 'iradio_square-blue',
					increaseArea: '20%' // optional
				});
				$('#loginForm').bootstrapValidator({
					fields: {
						email: {
							validators: {
								notEmpty: {
									message: '请输入邮箱'
								},
								emailAddress: {
									message: '请输入格式正确的邮箱'
								}
							}
						},
						password: {
							validators: {
								notEmpty: {
									message: '请输入密码'
								}
							}
						}

					}
				});

				// Validate the form manually
				$('#validateBtn').click(function() {
					var loginForm = $('#loginForm');
					loginForm.data('bootstrapValidator').validate();
					//是否通过校验
					if(!loginForm.data('bootstrapValidator').isValid()) {
						// 没有通过校验
						loginForm.bootstrapValidator('validate');

					} else {
						// 通过校验

						// console.log(loginForm.data('bootstrapValidator').isValid());
						var email = $("#email").val();
						var pwd = $("#password").val();
						var remember = $("#remember")[0].checked ? 1 : 0;
						//						console.log(remember);
						sessionStorage.setItem("remember", remember);

						$.ajax({
							type: "post",
							url: "/login",
							data: {
								email: email,
								pwd: pwd,
								remember: remember
							},
							success: function(data) {
								console.log(data);
								if(data.code == 1) {
									//									success
									$('#tipsModal').modal();
									$("#response-erro").html(data.msg);
									$(".spinner").css("display", "block");
									//保存密码
									sessionStorage.setItem(email, pwd);
									var home;
									switch(data.index) {
										case '1':
											home = '/role/index';
											break;
										case '2':
											home = '/user/index';
											break;
										case '3':
											home = '/normal/index';
											break;
									}
									console.log(home);
									console.log(data.index);
									setTimeout(function() {
										location.href = home;
									}, 2000);
								} else {
									$(".error-tips").css('display', 'block');
									$(".error-tips").html(data.msg);
								}

							},
							error: function(er) {
								var response = $.parseJSON(er);
								//								console.log(er.msg)
								$("#response-erro").html(er.msg);
								$(".spinner").css("display", "none");
							}

						})

					}

				});

			});
		</script>
	</body>

</html>